.include "macros.inc"

.section .text  # 0x8017F8B4 - 0x8017FA78

.global EraseCallback
EraseCallback:
/* 8017F8B4 0017C8B4  7C 08 02 A6 */	mflr r0
/* 8017F8B8 0017C8B8  90 01 00 04 */	stw r0, 4(r1)
/* 8017F8BC 0017C8BC  94 21 FF E0 */	stwu r1, -0x20(r1)
/* 8017F8C0 0017C8C0  93 E1 00 1C */	stw r31, 0x1c(r1)
/* 8017F8C4 0017C8C4  93 C1 00 18 */	stw r30, 0x18(r1)
/* 8017F8C8 0017C8C8  93 A1 00 14 */	stw r29, 0x14(r1)
/* 8017F8CC 0017C8CC  7C 9D 23 79 */	or. r29, r4, r4
/* 8017F8D0 0017C8D0  93 81 00 10 */	stw r28, 0x10(r1)
/* 8017F8D4 0017C8D4  3B 83 00 00 */	addi r28, r3, 0
/* 8017F8D8 0017C8D8  1C BC 01 10 */	mulli r5, r28, 0x110
/* 8017F8DC 0017C8DC  3C 60 80 24 */	lis r3, lbl_80245540@ha
/* 8017F8E0 0017C8E0  38 03 55 40 */	addi r0, r3, lbl_80245540@l
/* 8017F8E4 0017C8E4  7F E0 2A 14 */	add r31, r0, r5
/* 8017F8E8 0017C8E8  41 80 00 30 */	blt lbl_8017F918
/* 8017F8EC 0017C8EC  80 9F 00 C0 */	lwz r4, 0xc0(r31)
/* 8017F8F0 0017C8F0  3C 60 80 18 */	lis r3, WriteCallback@ha
/* 8017F8F4 0017C8F4  38 E3 F7 44 */	addi r7, r3, WriteCallback@l
/* 8017F8F8 0017C8F8  80 BF 00 0C */	lwz r5, 0xc(r31)
/* 8017F8FC 0017C8FC  A0 04 00 10 */	lhz r0, 0x10(r4)
/* 8017F900 0017C900  80 DF 00 B4 */	lwz r6, 0xb4(r31)
/* 8017F904 0017C904  38 7C 00 00 */	addi r3, r28, 0
/* 8017F908 0017C908  7C 85 01 D6 */	mullw r4, r5, r0
/* 8017F90C 0017C90C  4B FF C9 51 */	bl __CARDWrite
/* 8017F910 0017C910  7C 7D 1B 79 */	or. r29, r3, r3
/* 8017F914 0017C914  40 80 00 30 */	bge lbl_8017F944
lbl_8017F918:
/* 8017F918 0017C918  83 DF 00 D0 */	lwz r30, 0xd0(r31)
/* 8017F91C 0017C91C  38 00 00 00 */	li r0, 0
/* 8017F920 0017C920  38 7F 00 00 */	addi r3, r31, 0
/* 8017F924 0017C924  90 1F 00 D0 */	stw r0, 0xd0(r31)
/* 8017F928 0017C928  7F A4 EB 78 */	mr r4, r29
/* 8017F92C 0017C92C  4B FF B0 C9 */	bl __CARDPutControlBlock
/* 8017F930 0017C930  39 9E 00 00 */	addi r12, r30, 0
/* 8017F934 0017C934  7D 88 03 A6 */	mtlr r12
/* 8017F938 0017C938  38 7C 00 00 */	addi r3, r28, 0
/* 8017F93C 0017C93C  38 9D 00 00 */	addi r4, r29, 0
/* 8017F940 0017C940  4E 80 00 21 */	blrl 
lbl_8017F944:
/* 8017F944 0017C944  80 01 00 24 */	lwz r0, 0x24(r1)
/* 8017F948 0017C948  83 E1 00 1C */	lwz r31, 0x1c(r1)
/* 8017F94C 0017C94C  83 C1 00 18 */	lwz r30, 0x18(r1)
/* 8017F950 0017C950  83 A1 00 14 */	lwz r29, 0x14(r1)
/* 8017F954 0017C954  83 81 00 10 */	lwz r28, 0x10(r1)
/* 8017F958 0017C958  38 21 00 20 */	addi r1, r1, 0x20
/* 8017F95C 0017C95C  7C 08 03 A6 */	mtlr r0
/* 8017F960 0017C960  4E 80 00 20 */	blr 

.global CARDWriteAsync
CARDWriteAsync:
/* 8017F964 0017C964  7C 08 02 A6 */	mflr r0
/* 8017F968 0017C968  90 01 00 04 */	stw r0, 4(r1)
/* 8017F96C 0017C96C  94 21 FF C8 */	stwu r1, -0x38(r1)
/* 8017F970 0017C970  BF 61 00 24 */	stmw r27, 0x24(r1)
/* 8017F974 0017C974  3B 86 00 00 */	addi r28, r6, 0
/* 8017F978 0017C978  3B 65 00 00 */	addi r27, r5, 0
/* 8017F97C 0017C97C  3B E4 00 00 */	addi r31, r4, 0
/* 8017F980 0017C980  3B C3 00 00 */	addi r30, r3, 0
/* 8017F984 0017C984  3B A7 00 00 */	addi r29, r7, 0
/* 8017F988 0017C988  38 9B 00 00 */	addi r4, r27, 0
/* 8017F98C 0017C98C  38 BC 00 00 */	addi r5, r28, 0
/* 8017F990 0017C990  38 C1 00 1C */	addi r6, r1, 0x1c
/* 8017F994 0017C994  4B FF F9 85 */	bl __CARDSeek
/* 8017F998 0017C998  2C 03 00 00 */	cmpwi r3, 0
/* 8017F99C 0017C99C  40 80 00 08 */	bge lbl_8017F9A4
/* 8017F9A0 0017C9A0  48 00 00 C4 */	b lbl_8017FA64
lbl_8017F9A4:
/* 8017F9A4 0017C9A4  80 61 00 1C */	lwz r3, 0x1c(r1)
/* 8017F9A8 0017C9A8  80 83 00 0C */	lwz r4, 0xc(r3)
/* 8017F9AC 0017C9AC  38 84 FF FF */	addi r4, r4, -1
/* 8017F9B0 0017C9B0  7F 80 20 39 */	and. r0, r28, r4
/* 8017F9B4 0017C9B4  40 82 00 0C */	bne lbl_8017F9C0
/* 8017F9B8 0017C9B8  7F 60 20 39 */	and. r0, r27, r4
/* 8017F9BC 0017C9BC  41 82 00 10 */	beq lbl_8017F9CC
lbl_8017F9C0:
/* 8017F9C0 0017C9C0  38 80 FF 80 */	li r4, -128
/* 8017F9C4 0017C9C4  4B FF B0 31 */	bl __CARDPutControlBlock
/* 8017F9C8 0017C9C8  48 00 00 9C */	b lbl_8017FA64
lbl_8017F9CC:
/* 8017F9CC 0017C9CC  4B FF CD 15 */	bl __CARDGetDirBlock
/* 8017F9D0 0017C9D0  80 1E 00 04 */	lwz r0, 4(r30)
/* 8017F9D4 0017C9D4  54 00 30 32 */	slwi r0, r0, 6
/* 8017F9D8 0017C9D8  7C 83 02 14 */	add r4, r3, r0
/* 8017F9DC 0017C9DC  80 61 00 1C */	lwz r3, 0x1c(r1)
/* 8017F9E0 0017C9E0  4B FF F0 F9 */	bl __CARDIsWritable
/* 8017F9E4 0017C9E4  7C 64 1B 79 */	or. r4, r3, r3
/* 8017F9E8 0017C9E8  40 80 00 10 */	bge lbl_8017F9F8
/* 8017F9EC 0017C9EC  80 61 00 1C */	lwz r3, 0x1c(r1)
/* 8017F9F0 0017C9F0  4B FF B0 05 */	bl __CARDPutControlBlock
/* 8017F9F4 0017C9F4  48 00 00 70 */	b lbl_8017FA64
lbl_8017F9F8:
/* 8017F9F8 0017C9F8  38 7F 00 00 */	addi r3, r31, 0
/* 8017F9FC 0017C9FC  38 9B 00 00 */	addi r4, r27, 0
/* 8017FA00 0017CA00  4B FE 71 09 */	bl func_80166B08
/* 8017FA04 0017CA04  28 1D 00 00 */	cmplwi r29, 0
/* 8017FA08 0017CA08  41 82 00 0C */	beq lbl_8017FA14
/* 8017FA0C 0017CA0C  7F A0 EB 78 */	mr r0, r29
/* 8017FA10 0017CA10  48 00 00 0C */	b lbl_8017FA1C
lbl_8017FA14:
/* 8017FA14 0017CA14  3C 60 80 18 */	lis r3, __CARDDefaultApiCallback@ha
/* 8017FA18 0017CA18  38 03 97 EC */	addi r0, r3, __CARDDefaultApiCallback@l
lbl_8017FA1C:
/* 8017FA1C 0017CA1C  80 81 00 1C */	lwz r4, 0x1c(r1)
/* 8017FA20 0017CA20  3C 60 80 18 */	lis r3, EraseCallback@ha
/* 8017FA24 0017CA24  38 A3 F8 B4 */	addi r5, r3, EraseCallback@l
/* 8017FA28 0017CA28  90 04 00 D0 */	stw r0, 0xd0(r4)
/* 8017FA2C 0017CA2C  80 61 00 1C */	lwz r3, 0x1c(r1)
/* 8017FA30 0017CA30  93 E3 00 B4 */	stw r31, 0xb4(r3)
/* 8017FA34 0017CA34  80 61 00 1C */	lwz r3, 0x1c(r1)
/* 8017FA38 0017CA38  A0 1E 00 10 */	lhz r0, 0x10(r30)
/* 8017FA3C 0017CA3C  80 83 00 0C */	lwz r4, 0xc(r3)
/* 8017FA40 0017CA40  80 7E 00 00 */	lwz r3, 0(r30)
/* 8017FA44 0017CA44  7C 84 01 D6 */	mullw r4, r4, r0
/* 8017FA48 0017CA48  4B FF AC F9 */	bl __CARDEraseSector
/* 8017FA4C 0017CA4C  7C 7E 1B 79 */	or. r30, r3, r3
/* 8017FA50 0017CA50  40 80 00 10 */	bge lbl_8017FA60
/* 8017FA54 0017CA54  80 61 00 1C */	lwz r3, 0x1c(r1)
/* 8017FA58 0017CA58  7F C4 F3 78 */	mr r4, r30
/* 8017FA5C 0017CA5C  4B FF AF 99 */	bl __CARDPutControlBlock
lbl_8017FA60:
/* 8017FA60 0017CA60  7F C3 F3 78 */	mr r3, r30
lbl_8017FA64:
/* 8017FA64 0017CA64  BB 61 00 24 */	lmw r27, 0x24(r1)
/* 8017FA68 0017CA68  80 01 00 3C */	lwz r0, 0x3c(r1)
/* 8017FA6C 0017CA6C  38 21 00 38 */	addi r1, r1, 0x38
/* 8017FA70 0017CA70  7C 08 03 A6 */	mtlr r0
/* 8017FA74 0017CA74  4E 80 00 20 */	blr 
